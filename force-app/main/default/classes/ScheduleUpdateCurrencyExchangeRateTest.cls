@isTest
public class ScheduleUpdateCurrencyExchangeRateTest {
  // Dummy CRON expression: midnight on March 15.
  // Because this is a test, job executes
  // immediately after Test.stopTest().
  public static String CRON_EXP = '0 0 0 15 3 ? 2032';

  private class RestMock implements HttpCalloutMock {
    public HTTPResponse respond(HTTPRequest req) {
      String fullJson = '{"license":"https://openexchangerates.org/license","timestamp":1627459200,"base":"USD","rates":{"AED":3.6732,"AFN":79.982396,"ALL":103.140532,"AMD":486.680081,"ANG":1.795181,"AOA":639,"ARS":96.5936,"AUD":1.360924,"AWG":1.8005,"AZN":1.700805,"BAM":1.6554,"BBD":2,"BDT":84.816857,"BGN":1.655645,"BHD":0.376983,"BIF":1977.854282,"BMD":1,"BND":1.35785,"BOB":6.891301,"BRL":5.1697,"BSD":1,"BTC":0.000025096109,"BTN":74.287277,"BWP":11.125979,"BYN":2.511701,"BZD":2.015963,"CAD":1.258273,"CDF":1983.939261,"CHF":0.915117,"CLF":0.027832,"CLP":767.960454,"CNH":6.512357,"CNY":6.5038,"COP":3908.159682,"CRC":620.132517,"CUC":1,"CUP":25.75,"CVE":94.225,"CZK":21.768244,"DJF":177.665539,"DKK":6.299296,"DOP":56.945169,"DZD":134.716963,"EGP":15.7145,"ERN":15.004625,"ETB":44.230201,"EUR":0.846953,"FJD":2.08335,"FKP":0.720839,"GBP":0.720839,"GEL":3.085,"GGP":0.720839,"GHS":5.918196,"GIP":0.720839,"GMD":51.15,"GNF":9749.234142,"GTQ":7.748412,"GYD":208.798293,"HKD":7.78372,"HNL":23.699434,"HRK":6.3527,"HTG":95.915996,"HUF":304.386707,"IDR":14488.75,"ILS":3.25213,"IMP":0.720839,"INR":74.365556,"IQD":1456.0704,"IRR":42153.749835,"ISK":126.2,"JEP":0.720839,"JMD":154.249034,"JOD":0.709,"JPY":109.97015385,"KES":108.55,"KGS":84.483048,"KHR":4061.843785,"KMF":416.150217,"KPW":900,"KRW":1155.609245,"KWD":0.300757,"KYD":0.833256,"KZT":425.541947,"LAK":9527.700444,"LBP":1509.169578,"LKR":199.021949,"LRD":171.700027,"LSL":14.853789,"LYD":4.516754,"MAD":8.939673,"MDL":17.916421,"MGA":3809.562335,"MKD":52.159378,"MMK":1646.180811,"MNT":2850.187285,"MOP":7.999831,"MRO":356.999828,"MRU":36.12,"MUR":42.8,"MVR":15.45,"MWK":808.350894,"MXN":19.980907,"MYR":4.235,"MZN":63.626999,"NAD":14.87,"NGN":411.5,"NIO":35.039357,"NOK":8.895355,"NPR":119.108583,"NZD":1.438957,"OMR":0.385038,"PAB":1,"PEN":3.90016,"PGK":3.549018,"PHP":50.4125,"PKR":161.724223,"PLN":3.896549,"PYG":6901.38785,"QAR":3.64,"RON":4.1662,"RSD":99.512498,"RUB":73.589667,"RWF":1005.210074,"SAR":3.750428,"SBD":8.061372,"SCR":14.415299,"SDG":446.5,"SEK":8.63732,"SGD":1.359976,"SHP":0.720839,"SLL":10248.900158,"SOS":577.314519,"SRD":21.428,"SSP":130.26,"STD":20699.012016,"STN":21.07,"SVC":8.749014,"SYP":1257.475248,"SZL":14.853852,"THB":32.895712,"TJS":11.382502,"TMT":3.5,"TND":2.7905,"TOP":2.262266,"TRY":8.558624,"TTD":6.784088,"TWD":28.012499,"TZS":2319,"UAH":26.820708,"UGX":3549.969663,"USD":1,"UYU":43.807697,"UZS":10635.998712,"VES":3991928.75,"VND":22975.067236,"VUV":110.812851,"WST":2.563083,"XAF":555.564621,"XAG":0.04037731,"XAU":0.00055471,"XCD":2.70255,"XDR":0.70356,"XOF":555.564621,"XPD":0.00038104,"XPF":101.068354,"XPT":0.00094386,"YER":250.050119,"ZAR":14.819037,"ZMW":18.986796,"ZWL":322}}';

      HTTPResponse res = new HTTPResponse();
      res.setHeader('Content-Type', 'text/json');
      res.setBody(fullJson);
      res.setStatusCode(200);
      return res;
    }
  }

  @isTest
  static void createDatedConversionRate() {
    Test.startTest();
    Test.setMock(HttpCalloutMock.class, new RestMock());
    // Schedule the test job
    String jobId = System.schedule(
      'ScheduledApexTest',
      CRON_EXP,
      new ScheduleUpdateCurrencyExchangeRate()
    );
    // Stopping the test will run the job synchronously
    Test.stopTest();
  }
}